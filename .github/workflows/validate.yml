name: Validate Plugin

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Validate JSON files
      run: |
        echo "Validating plugin.json..."
        jq empty .claude-plugin/plugin.json

        echo "Validating marketplace.json..."
        jq empty .claude-plugin/marketplace.json

        echo "Validating .mcp.json..."
        jq empty .mcp.json

        echo "✅ All JSON files are valid!"

    - name: Check file structure
      run: |
        echo "Checking required files..."

        required_files=(
          ".claude-plugin/plugin.json"
          ".claude-plugin/marketplace.json"
          ".mcp.json"
          "README.md"
          "LICENSE"
          "CHANGELOG.md"
          "agents/red-agent.md"
          "agents/gold-agent.md"
          "agents/blue-agent.md"
          "agents/green-agent.md"
          "skills/comms/SKILL.md"
          "commands/mission-status.md"
        )

        for file in "${required_files[@]}"; do
          if [ ! -f "$file" ]; then
            echo "❌ Missing required file: $file"
            exit 1
          fi
        done

        echo "✅ All required files present!"

    - name: Verify executable permissions
      run: |
        if [ ! -x "skills/comms/scripts/broadcast.sh" ]; then
          echo "❌ broadcast.sh is not executable"
          exit 1
        fi
        echo "✅ Scripts have correct permissions!"
